# 브라우저 동작

브라우저 동작 과정 = 오픈 소스 브라우저(크롬, 파이어폭스, 사파리 등)의 주소 창에 URL을 입력했을 때, 해당 웹 페이지가 사용자의 화면에 보이기까지의 과정

<br>

## 1. 브라우저

브라우저(Browser): 인터넷을 통해 웹 페이지를 검색하고 표시하는 소프트웨어. 사용자가 웹 페이지에 접근하고 정보를 검색하며, 웹 애플리케이션을 실행할 수 있도록 도와주며, 그밖의 다양한 기능을 제공하여 사용자에게 편리한 웹 환경 제공.

> Google Chrome, Mozilla Firefox, Microsoft Edge, Apple Safari, 네이버 웨일

<br>

## 2. 주요 기능

: 사용자가 선택한 자원을 서버에 요청, HTML, CSS, JavaScript 등의 웹 기술을 사용하여 웹 페이지에 표시함. 자원은 html, pdf, image 등 다양한 형태를 가지는데, 자원의 주소는 URI에 의해 정해짐. 사용자는 주소 표시줄에 URL(Uniform Resource Locator)을 입력하여 특정 웹 페이지로 이동, 이때 브라우저는 입력된 주소로 요청을 보내고 해당 페이지를 표시함.

그 외 제공하는 기능

- 앞으로 가기, 뒤로 가기, 새로 고침 등의 탐색 기능
- 북마크 / 방문한 페이지 히스토리
- 다중 탭
- HTTPS를 통한 안전한 연결, 쿠키 및 웹 사이트 데이터의 관리, 피싱 사이트 차단 등 보안 기능
- 다양한 플러그인 / 확장 프로그램
- 웹 개발자 도구 (웹 페이지 디버깅 / 성능 향상 등의 작업 가능)

---

브라우저는 html과 css 명세를 통해 파일을 해석해서 웹 페이지에 표시함.

> 예전 브라우저들은 일부만 명세에 따라 구현하고 독자적 방법으로 확장했으나, 심각한 호환성 문제로 인하여 요즘은 대부분 표준 명세를 따름. 이 '명세'는 CSS 언어의 표준에 대한 문서로, 웹 브라우저 업체 및 웹 개발자들 간의 일관된 동작을 보장하기 위해 웹 표준화 기구인 **W3C**(World wide web Consortium)에서 관리함.

<br>

## 3. 기본 구조

---

<img src="https://d2.naver.com/content/images/2015/06/helloworld-59361-1.png">

<br>

### 사용자 인터페이스 (User Interface):

- 사용자가 브라우저와 상호 작용하는 부분
- 주소 표시줄, 이전/다음 버튼, 북마크 등 사용자가 활용하는 서비스들

### 브라우저 엔진 (Browser Engine):

- 사용자 인터페이스와 렌더링 엔진 사이의 동작 제어
- 사용자의 입력에 따라 렌더링 엔진에 작업을 요청하고, 렌더링 엔진에서 받은 내용을 사용자에게 표시

### 렌더링 엔진 (Rendering Engine):

- 요청한 콘텐츠(웹 페이지 내용) 표시
- HTML 문서와 CSS 스타일 시트, XML 문서 등을 해석(파싱)하고, 그 결과물을 화면에 표시

### 통신 (Networking):

- 네트워크 호출 처리 (URL 파싱, http / https 프로토콜 반환)
- HTTP 요청과 응답을 처리하여 필요한 리소스 가져옴
  (플랫폼의 독립적인 인터페이스로 구성되어있음)

### 자바스크립트 해석기 (JavaScript Interpreter):

- 자바스크립트 코드를 해석 및 실행
  (현대의 브라우저는 대부분 자바스크립트 엔진으로 V8(Chrome), SpiderMonkey(Firefox), JavaScriptCore(Safari) 등을 사용)

### UI 백엔드 (UI Backend):

- 플랫폼에서 명시하지 않은 일반적 인터페이스. 콤보 박스 창같은 기본적 장치를 그림
- 각 OS의 API를 사용한 UI

### 자료 저장소 (Data Persistence):

- 데이터 저장소는 쿠키, 캐시, 서비스워커, 로컬 스토리지 등 모든 데이터를 HDD에 저장

<br>

그 외 . . .

- 보안 및 개인정보 보호 (Security and Privacy)
- 자동화 (Automation)

<br>

> 참고 : [브라우저의 구조](https://another-light.tistory.com/41)

<br>

## 4. 렌더링

: HTML, CSS, JavaScript 등을 사용하여 웹 페이지를 브라우저에 표시하는 과정

렌더링 엔진은 요청 받은 내용을 브라우저 화면에 표시함. 기본적으로 html, xml 문서와 이미지를 표시할 수 있으나, 추가로 플러그인이나 브라우저 확장 기능을 통해 pdf, hwp 등 다른 타입도 표시 가능.

<br>

### 사전 지식: 파싱(parsing)

- 문서 파싱 = 서버로부터 받은 문서를 브라우저가 코드를 이해하고 사용할 수 있는 DOM 트리 구조로 변환하는 작업

: 파서 생성기 등을 통해서, 문서에 대한 어휘 분석과 구문 분석 과정을 거쳐 파싱 트리를 구축함. 해당 언어의 구문 규칙에 따라 문서 구조를 분석하여, 구문 규칙과 일치하는 지 비교하고, 일치하는 노드만 파싱 트리에 추가함. 이후 파싱 트리를 다시 기계코드 문서로 변환.

### 사전 지식: DOM 트리

- DOM: Document Object Model(문서 객체 모델)

웹페이지 소스의 `<html>, <body>`와 같은 태그들을 Javascript가 활용할 수 있는 문서 객체로 만든 것. 즉, DOM은 **웹 브라우저가 HTML 페이지를 인식하는 방식**을 말하며, 이것은 트리 구조를 가지고 있음.

<br>

### 렌더링 동작 과정

```
1. DOM 트리 구축을 위한 HTML 파싱
2. CSS 파싱
3. 렌더 트리 구축
4. 레이아웃 (Layout) / 렌더 트리 배치 (Reflow)
5. 페인팅 (Painting) 및 합성 (Compositing)
```

<br>

1. DOM 트리 구축을 위한 HTML 파싱

   먼저 HTML 문서를 파싱한다. 이를 통해 HTML 문서의 요소들이 브라우저에 어떻게 배치될지 결정됨.

   그리고 콘텐츠 트리 내부에서 태그를 모두 DOM(Document Object Model) 노드로 변환함. DOM 트리는 문서의 요소들을 계층 구조로 표현하며, 웹 페이지의 구조를 나타냄.

2. CSS 파싱

   그 다음 외부 CSS 스타일 시트와 함께 포함된 스타일 요소를 파싱함. 이후 각 요소에 적용될 스타일 규칙 결정. (스타일 규칙의 우선순위와 상속 등을 고려)

3. 렌더 트리 구축

   DOM 트리와 CSS 스타일 정보를 기반으로 렌더 트리(Render Tree)를 구축.

   렌더 트리는 화면에 실제로 표시될 요소들을 나타내는 트리 구조. (화면에 표시되지 않는 요소는 제외)

4. 레이아웃 (Layout) / 렌더 트리 배치 (Reflow)

   이렇게 생성된 렌더 트리는 정해진 순서대로 화면에 표시되는데, 이때 렌더 트리의 각 노드에 대해 크기와 위치를 계산하여 노드가 화면의 정확한 위치에 표시되도록 하는 레이아웃 과정이 수행됨.

5. 페인팅 (Painting) 및 합성 (Compositing)

   레이아웃이 결정되면, 렌더 트리의 각 노드에 대해 실제로 화면에 픽셀을 그리는 페인팅 단계가 진행됨. 이는 UI 백엔드에서 렌더 트리의 각 노드를 가로지으며 형상을 만드는 그리기 과정.

   이후 각 레이어를 합성하여 최종 화면을 생성. (GPU를 사용하여 성능 향상시킴)

<br>

▷ 이러한 렌더링 과정은 사용자가 웹 페이지를 요청할 때마다 발생하며, 사용자의 상호 작용이나 웹 페이지의 동적 변화에 따라 다시 수행될 수 있음.

▷ 각 과정은 기본적으로 점진적으로 진행되지만, 최신 웹 브라우저들은 이러한 과정을 최적화하여 렌더링 엔진이 모든 html을 파싱할 때까지 기다리지 않고 배치와 페인팅을 시작하도록 하고 있음. (전송을 받고 기다리는 동시에 받은 내용을 먼저 화면에 보여주는 방식)

<br>
<br>

### [참고 자료]

- [네이버 D2](https://d2.naver.com/helloworld/59361)
- [브라우저 동작 방법.md](https://github.com/gyoogle/tech-interview-for-developer/blob/master/Web/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%20%EB%8F%99%EC%9E%91%20%EB%B0%A9%EB%B2%95.md)
