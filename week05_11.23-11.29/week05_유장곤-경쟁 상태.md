# 운영체제- 경쟁상태 (Race Condition)
---

경쟁 상태란 두 개 이상의 프로세스(혹은 스레드)가 하나의 자원(리소스)에 접근하기 위해 경쟁하는 상태.
프로그램이나 시스템 등의 실행/출력 결과가 일정하지 않고 입력의 타이밍, 실행 순서 등에 영향을 받아 결과가 달라질 수 있으므로 버그를 일으킬 수 있다.





- 유저모드: 사용자가 접근할 수 있는 영역을 제한적으로 두고, 프로그램의 자원에 함부로 접근하지 못하는 모드. 코드를 작성하고, 프로세스를 실행하는 행동을 할 수 있다.

- 커널모드: 모든 자원(CPU, 메모리 등) 접근, 명령 가능한 모드

- 프로세스간에는 주소 공간이 독립적이지만 커널에 있는 자원은 여러 프로세스가 공유할 수 있기 때문에 주로 유저모드보다 커널모드일 때 Race Condition이 발생한다.



# 경쟁 상태(Race Condition) 가 발생하는 경우
---

- 계란 이야기

- 커널 코드 실행 중에 인터럽트가 발생한 경우
	커널 모드에서 데이터 로드 작업을 하던 도중 인터럽트가 발생하여 같은 데이터를 조작하는 경우에 발생할 수 있다.
	``` 인터럽트 :  프로세스 실행 도중 예기치 않은 상황이 발생할 때 발생한 상황을 처리한 후 실행 중인 작업으로 복귀하는 것 ```
    커널이 가진 전역변수는 모든 프로세스의 공유물이므로 경쟁상태의 가능성이 있다. 

 

- 프로세스가 시스템 콜(System call)을 하여 커널 모드로 진입해서 작업을 수행하는 도중에 문맥 교환이 일어난 경우 
ex) 프로세스1이 커널 모드에서 데이터를 조작하던 도중 시간이 초과되어 CPU제어권이 프로세스2로 넘어가 같은 데이터를 조작하는 경우를 말한다.

 

-  멀티 프로세서 환경에서 2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근하여 조작하는 경우
(또는 멀티 스레드 환경에서 공통 자원을 병행하여 작업하는 경우)
멀티프로세스 환경에서 2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근하여 조작하는 경우에 발생할 수 있다.


# Critical Section(임계영역)
---
둘 이상의 스레드가 동시에 실행될 경우가 생길 수 있는, = 경쟁 조건이 발생될 수 있는 코드 블록.
운영체제에서 여러 프로세스가 데이터를 공유하면서 수행될 때 각 프로세스에서 공유 자원에 접근하는 프로그램 코드 부분을 의미한다.

-> 공유 데이터를 사용하기 때문에 아무나 접근하지 못하게 보호되어야 하는 부분.
프로세스간에 공유자원을 접근하는데 있어서 문제가 발생하지 않도록 공유자원의 독점을 보장해줘야 하는 영역이다. 

#### => 동기화! (탈의실)



Race Condition 해결을 위한 충족 조건 3가지 

- Mutual Exclusion (상호 배제)
어떤 프로세스가 임계 영역을 수행 중이면 다른 모든 프로세스들은 그 임계 영역에 들어가지 못하게 막는 것이다.
 
- Progress(진행)
임계 영역에 들어간 프로세스가 있지 않은 상태에서 임계 영역에 들어가려는 프로세스가 있으면 들어가게 해주어야 한다. 즉, 임계영역에 있는 프로세스 외에는 다른 프로세스가 임계 영역에 진입하는 것을 방해하면 안된다.
 
- Bounded Waiting(한정 대기)
기아(starvation) 상태를 방지하기 위해 프로세스가 임계 영역에 들어가려고 요청한 후부터 다른 프로세스들이 임계 영역에 들어가는 횟수에 한계가 있어야 한다. 
상호 배제로 기다리는 프로세스가 무한 대기하지 않아야 한다.




```
do {
	/*
    entry section (진입 구역)
    */
    
    /*
    critical section (임계 구역)
    */
    
    /*
    exit section (퇴출 구역)
    */
    
    /*
    remainder section (진입구역)
    */
    
    } while(TRUE)
   ```
    
    
  


ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ



출처: 
https://zangzangs.tistory.com/115
https://brightstarit.tistory.com/10
https://daily-progress.tistory.com/65
https://charles098.tistory.com/88