# OAuth

## 1. Open Authorization

OAuth(Open Authorization)는 웹 및 모바일 애플리케이션을 위한 개방형 표준 인증 프로토콜 중 하나.

주로 서드파티 애플리케이션이 사용자의 리소스에 접근할 때, 사용자의 비밀번호를 제공하지 않고도 타사 애플리케이션 및 웹사이트의 계정에 대한 정보를 공유하여, 그를 통해 다른 서비스에 대한 제한된 액세스를 얻을 수 있도록 함.

`= 인터넷 사용자들이 비밀번호를 제공하지 않고, 다른 웹사이트 상의 자신들의 정보에 대해 타 웹사이트나 애플리케이션의 접근 권한을 부여하는 인증 방식`

ex. 소셜 로그인 / 소셜 로그인 연동
![소셜 로그인](https://cdn.imweb.me/upload/5bf5066ac9165.png)

<br>

## 2. 작동 주체와 주요 요소

- **리소스 소유자(Resource Owner)**: 자신의 데이터 또는 서비스에 대한 액세스를 제어하는 주체. 계정을 가지고 있는 개인.

- **클라이언트(Client)**: 리소스 소유자의 데이터에 접근하려는 애플리케이션 또는 서비스. OAuth를 사용해 서비스 제공자에게 접근하는 서드파티 애플리케이션이나 웹 서비스 등.

- **인증 서버(Authorization Server)**: 클라이언트가 리소스에 접근하기 위한 권한을 부여하고, 클라이언트에게 액세스 토큰을 발급하는 서버. 이를 통해 클라이언트는 리소스 서버에 접근할 수 있음.

- **리소스 서버(Resource Server)**: 실제로 보호되는 리소스를 호스팅하며, 클라이언트가 액세스하려는 데이터를 제공하는 서버.

<br>

## 3. 인증 과정 flow

OAuth의 주요 flow는 여러 가지가 있으며, 각각의 flow은 특정한 사용 목적 및 환경에 맞게 선택됨.

### Authorization Code Flow:

1. 클라이언트가 리소스 소유자를 인증 서버로 리디렉션
2. 리소스 소유자가 로그인하고 권한 부여
3. 인증 서버가 인증 코드 발급
4. 클라이언트는 인증 코드를 사용하여 액세스 토큰을 인증 서버에 요청
5. 인증 서버는 클라이언트에게 액세스 토큰을 제공
6. 클라이언트는 발급받은 액세스 토큰을 사용하여 리소스 서버에 접근 / 필요한 데이터 요청

→ 안전하고 권장되는 흐름. 웹 애플리케이션. 안전한 환경에서 사용되는 클라이언트.

### Implicit Flow:

1. 클라이언트가 리소스 소유자를 인증 서버로 리디렉션
2. 리소스 소유자가 로그인하고 권한 부여
3. 인증 서버가 액세스 토큰을 직접 클라이언트에게 제공
4. 클라이언트는 발급받은 액세스 토큰을 사용하여 리소스 서버에 직접 접근 / 필요한 데이터 요청

→ 간단하고 빠른 인증 흐름. 싱글 페이지 애플리케이션(SPA). 모바일 앱 등 클라이언트 시크릿을 안전하게 보관할 수 없는 경우.

### Resource Owner Password Credentials Flow

1. 클라이언트가 사용자의 아이디와 비밀번호를 직접 받아서 인증 서버에 대신 제출
2. 인증 서버는 클라이언트에게 직접 액세스 토큰을 발급
3. 클라이언트는 발급받은 액세스 토큰을 사용하여 리소스 서버에 접근 / 필요한 데이터 요청

→ 사용자의 자격 증명이 클라이언트에게 직접 노출되기 때문에 보안에 취약. 자원 소유자가 자신의 자격 증명을 안전하게 입력할 수 있는 경우. 안전한 환경에서만 사용을 권장.

### Client Credentials Flow:

1. 클라이언트가 직접 액세스 토큰을 인증 서버에 요청
2. 인증 서버는 클라이언트의 신원을 확인하고 액세스 토큰 발급
3. 클라이언트는 발급받은 액세스 토큰을 사용하여 리소스 서버에 접근 / 필요한 데이터 요청

→ 사용자 관련 기능이 없는 서버 간 통신(클라이언트가 사용자와 직접 상호 작용하지 않고 자격 증명을 안전하게 보관할 수 있는 경우)에 적합. 클라이언트가 사용자 인증을 할 필요 없이 자원에 직접 접근하여 다른 서비스의 데이터를 가져오는 경우.

<br>

## 4. 예시 (Implicit Flow 활용)

> 예시: 리소스 소유자 (사용자) - 클라이언트 (깃허브) - 리소스 서버 (구글)

1. 깃허브가 구글에게 Authorized URI 요청
2. 구글이 깃허브에게 Authorized URI 발급
3. 깃허브가 해당 URI 통해 사용자를 구글로 이동
4. 구글에서 사용자 인증 수행
5. 구글이 사용자를 깃허브로 재이동하며 Authorization Code 발급
6. 깃허브가 Authorization Code 제출하며 구글에게 Access Token 요청
7. 구글이 Authorization Code 일치 여부 확인
8. 구글이 깃허브에게 Access Token 발급
9. 깃허브에서 Access Token 이용해 구글 내의 사용자 정보에 접근

<br>

## 5. 이중 토큰

Access Token만 사용하며 매번 새롭게 인증하는 경우도 있지만, Refresh Token과 함께 사용하는 경우도 많음. Refresh Token을 클라이언트가 가지고 있다가 리소스 서버측에 Access Token 갱신을 요청하는 방식.

### Access Token

: 리소스에 접근하기 위한 토큰. 클라이언트가 보호된 리소스에 접근할 때 사용. 유효 기간이 짧고, 주기적으로 갱신 필요.

### Refresh Token

: Access Token을 갱신하거나 새로 발급하기 위한 토큰. 보통 Access Token이 만료되면 Refresh Token을 사용하여 갱신하는데 사용. 유효 기간이 상대적으로 길며, 보안을 위해 안전한 저장소에 저장되어야 함.

→ 일반적으로 Access Token과 Refresh Token은 동시에 발급되지만, OAuth 인증 서버의 구현 방식에 따라 다를 수 있음.

<br>

> OAuth는 보안성과 사용자 편의성을 모두 고려하여 클라이언트가 안전하게 리소스에 액세스할 수 있도록 함. 최신 버전인 OAuth 2.0은 많은 웹 및 모바일 애플리케이션에서 광범위하게 사용되고 있음.
